# biolog_calendar.py

## 📌 Описание проекта
Этот Python-скрипт предназначен для автоматизации рабочего процесса.  
Он ежедневно подключается к **RetailCRM**, находит все заказы, содержащие услугу **«Выезд биолога»**, и автоматически создает соответствующие события в **Google Календаре**.  

Это помогает:
- упростить планирование выездов;
- обеспечить видимость для всех заинтересованных сторон.

---

## 🔑 Ключевые функции
- **Автоматическое создание событий** — события создаются в Google Календаре на основе данных из заказов.  
- **Гибкий поиск** — поиск заказов по артикулам услуг для точности и надежности.  
- **Интеллектуальное обновление** — использование `token.pickle` для автоматического обновления токена доступа (без повторной авторизации).  
- **Детализация** — каждое событие в календаре содержит:
  - имя клиента,  
  - телефон,  
  - имя менеджера,  
  - имя биолога,  
  - прямую ссылку на заказ в RetailCRM.  
- **Журналирование** — все действия и ошибки пишутся в лог-файл для удобной отладки и мониторинга.  

---

## 🛠 Используемые технологии
- Python 3.x  
- [Google API Client for Python](https://github.com/googleapis/google-api-python-client)  
- requests  
- python-dotenv  

---

## 🚀 Подготовка и установка

### 1. Клонирование репозитория
```bash
git clone https://github.com/Lavr-18/RetailCRM_to_GoogleCalendar.git
cd RetailCRM_to_GoogleCalendar
```

### 2. Настройка среды
Создайте виртуальное окружение и установите зависимости:
```bash
python3 -m venv .venv
source .venv/bin/activate  # Для Linux/macOS
.\.venv\Scripts\activate   # Для Windows
pip install -r requirements.txt
```

### 3. Настройка учетных данных
Для работы скрипту необходимы API-ключи и учетные данные.

**RetailCRM**:
- В личном кабинете создайте API-ключ с доступом к методам `orders` и `orders.custom-fields`.

**Google Calendar**:
1. В Google Cloud Console создайте проект.  
2. Включите **Google Calendar API**.  
3. Создайте учетные данные типа **OAuth 2.0 Client ID** для десктопного приложения.  
4. Скачайте файл `credentials.json`.  

**token.pickle**:
- Создается автоматически при первом запуске и хранит токены авторизации.

**.env файл** (создайте в корневой папке проекта):
```ini
RETAILCRM_BASE_URL="https://tropichouse.retailcrm.ru"
RETAILCRM_API_KEY="ВАШ_КЛЮЧ_API"
RETAILCRM_SITE_CODE="tropichouse"

# Добавляется после первого запуска скрипта
# GOOGLE_CALENDAR_ID="ID_ВАШЕГО_КАЛЕНДАРЯ"
```

---

### 4. Первый запуск
При первом запуске откроется браузер для авторизации:
```bash
python biolog_calendar.py
```
После успешной авторизации:
- появится файл `token.pickle`;  
- в консоль выведется `ID` нового календаря, который нужно добавить в `.env`.

---

## ⚡ Автоматический запуск (Cron)
Для ежедневного запуска используйте планировщик **Cron**.

Откройте crontab:
```bash
crontab -e
```

Добавьте строку для запуска скрипта каждый день в **20:00**:
```bash
0 20 * * * /usr/bin/python3 /путь/к/папке/проекта/biolog_calendar.py >> /путь/к/папке/проекта/biolog_calendar.log 2>&1
```

---
